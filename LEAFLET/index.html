<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leafletjs Data Retrieval</title>

    <link rel="stylesheet" href="style.css" />
    <!-- LEAFLETJS CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
      integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
      crossorigin=""
    />
  </head>
  <body>
    <div id="siteWrap">
      <div id="mapWrap">
        <!--MAP ENCLOSURE-->
        <div id="map"></div>
        <!--MAP ENCLOSURE-->
      </div>
      <div id="dataTable">
        <div id="coordDisplay"></div>
        <div id="dataWrapRight">
          <div id="varDisplay">
            Lorem ipsum dolor sit amet consectetur adipisicing elit. Quibusdam
            alias incidunt, vel tempora porro cum fugit dolor sunt voluptatum
            obcaecati repudiandae. Delectus quaerat reiciendis eos aspernatur
            cumque facilis laudantium dicta.
          </div>
          <div id="routeDisplay">
            Lorem, ipsum dolor sit amet consectetur adipisicing elit. Quaerat
            molestiae odit minima, dicta incidunt voluptatem possimus reiciendis
            eveniet impedit adipisci illo quasi iste ex aspernatur accusamus
            provident magnam officiis error?
          </div>
        </div>
      </div>
    </div>
  </body>
</html>

<!-- LEAFLETJS JS -->
<script
  src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
  integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
  crossorigin=""
></script>

<!-- ADD MAP SCRIPT -->
<script>
  // Map initializtion
  var map = L.map("map").setView([47.5655, -52.706], 17);

  // OSM Layer
  let osm = L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution:
      '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
  });

  // GoogleStreets Layer
  let googleStreets = L.tileLayer(
    "http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",
    {
      maxZoom: 20,
      subdomains: ["mt0", "mt1", "mt2", "mt3"],
    }
  );

  // Add Layers to map
  osm.addTo(map);

  // Custom Icon
  let myIcon = L.icon({
    iconUrl: "icon.png",
    iconSize: [50, 50],
    iconAnchor: [22, 94],
    popupAnchor: [-3, -76],
  });

  // Marker
  let singleMarker = L.marker([47.56263613992803, -52.70831949094821], {
    icon: myIcon,
    draggable: true,
    autoPan: true,
  }).addTo(map);

  // PopUp
  let popUp = singleMarker
    .bindPopup(
      '<center><b>GET <font color="#87aade">CODING</font></b></center> <br />' +
        singleMarker.getLatLng()
    )
    .openPopup();
  popUp.addTo(map);

  console.log(singleMarker.toGeoJSON());

  if (!navigator.geolocation) {
    console.log("Browser does not support GeoLocation");
  } else {
    setInterval = () => {
      navigator.geolocation.getCurrentPosition(getPosition);
    };
  }

  function getPosition(position) {
    console.log(position);
    let lat = position.coords.latitude;
    let long = position.coords.longitude;
    let accuracy = position.coords.accuracy;

    let marker = L.marker([lat, long], { icon: myIcon }).addTo(map);
    let circle = L.circle([lat, long], { radius: accuracy }).addTo(map);
    let featureGroup = L.featureGroup([marker, circle]).addTo(map);

    map.fitBounds(featureGroup.getBounds());
    console.log(lat, long, accuracy);
    addCoords(lat, long, accuracy);
  }

  // Function to add datat to dashboard
  function addCoords(lat, long, accuracy) {
    let coordinateDisplay = document.getElementById("coordDisplay");

    let newCoordHTML = `<div class="coords">
      Latitude: ${lat} | Longitude: ${long} | Accuracy: ${accuracy} <br />
      </div>`;
    coordinateDisplay.innerHTML += newCoordHTML;
  }
</script>
